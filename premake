# /bin/sh
: '
Set up the environment for the sh, workflow, driver module, and submodule directories.

Usage:
  . premake
  source premake

Licensed under the BSD 3-Clause License. Authors: Teng Zhang (zhteg4@gmail.com)
'

# Premake and Shell Type
if [ $(basename $0) = 'premake' ]
then
  PREMAKE="$0" && echo "Shell Type: zsh"
elif [ $BASH_SOURCE ]
  then
  PREMAKE=${BASH_SOURCE[0]} && echo "Shell Type: POSIX"
else
  x="$(lsof -p $$ -Fn0 | tail -1 | tr -d "\0")" && PREMAKE=${x#*n} && echo "Shell Type: dash"
fi
[ ! -f $PREMAKE ] && echo "Cannot locate this premake script" && return

add_path() {
  echo $PATH | grep -q "$1" || export PATH="$1${PATH:+":$PATH"}"
}

add_pypath() {
  echo $PYTHONPATH | grep -q "$1" || export PYTHONPATH="$1${PYTHONPATH:+":$PYTHONPATH"}"
}

# NEMD_SRC
export NEMD_SRC="$(readlink -f ${PREMAKE} | xargs dirname)"
[ -d $NEMD_SRC ] && echo \$NEMD_SRC=$NEMD_SRC

# Shell Script
export NEMD_SH=$NEMD_SRC/sh
[ -d $NEMD_SH ] && echo \$NEMD_SH=$NEMD_SH && add_path $NEMD_SH

# Workflow
export NEMD_WORKFLOW=$NEMD_SRC/workflow
[ -d $NEMD_WORKFLOW ] && echo \$NEMD_WORKFLOW=$NEMD_WORKFLOW && add_pypath $NEMD_WORKFLOW

# Driver
export NEMD_DRIVER=$NEMD_SRC/driver
[ -d $NEMD_DRIVER ] && echo \$NEMD_DRIVER=$NEMD_DRIVER && add_pypath $NEMD_DRIVER

# Module
NEMD_MODULE=$NEMD_SRC/module
[ -d $NEMD_MODULE ] && echo \$NEMD_MODULE=$NEMD_MODULE && add_pypath $NEMD_MODULE

# Submodule

# Alamode
ALAMODE=$NEMD_SRC/module/alamode
export ALAMODE_TOOLS=$ALAMODE/alamode/tools
[ -d $ALAMODE_TOOLS ] && echo "\$ALAMODE_TOOLS=$ALAMODE/alamode/tools"
ALAMODE_BUILD=$ALAMODE/build/
[ -d $ALAMODE_BUILD ] &&  echo \$ALAMODE_BUILD=$ALAMODE_BUILD && add_path $ALAMODE_BUILD
ALAMODE_BTOOLS=$ALAMODE_BUILD/tools
[ -d $ALAMODE_BTOOLS ] && echo "\$ALAMODE_BTOOLS=$ALAMODE_BTOOLS" && add_path $ALAMODE_BTOOLS

# Lammps
LAMMPS_BUILD=$NEMD_SRC/module/lammps/build
[ -d $LAMMPS_BUILD ] &&  echo \$LAMMPS_BUILD=$LAMMPS_BUILD && add_path $LAMMPS_BUILD
